<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Registration</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0-alpha1/css/bootstrap.min.css">
</head>
<body>
    <div class="container">
        <h2 class="mt-5">Register</h2>
        
        <form id="registrationForm" method="POST" action="{% url 'register' %}" novalidate>
            {% csrf_token %}
            
            <!-- Username Field -->
            <div class="mb-3">
                <label for="username" class="form-label">Username</label>
                <input type="text" class="form-control {% if form.username.errors %}is-invalid{% endif %}" 
                       id="username" name="username" placeholder="abc" maxlength="20">
                <div id="usernameError" class="invalid-feedback">
                    {% for error in form.username.errors %}
                        {{ error }}
                    {% endfor %}
                </div>
            </div>

            <!-- First Name Field -->
            <div class="mb-3">
                <label for="first_name" class="form-label">First Name</label>
                <input type="text" class="form-control" id="first_name" name="first_name" placeholder="your first name" maxlength="20">
                <div id="firstNameError" class="invalid-feedback"></div>
            </div>

            <!-- Last Name Field -->
            <div class="mb-3">
                <label for="last_name" class="form-label">Last Name</label>
                <input type="text" class="form-control" id="last_name" name="last_name" placeholder="your last name" maxlength="20">
                <div id="lastNameError" class="invalid-feedback"></div>
            </div>

        
            <!-- Email Field -->
            <div class="mb-3">
                <label for="email" class="form-label">Email</label>
                <input type="text" class="form-control {% if form.email.errors %}is-invalid{% endif %}" 
                       id="email" name="email" placeholder="abc@example.com">
                <div id="emailError" class="invalid-feedback">
                    {% for error in form.email.errors %}
                        {{ error }}
                    {% endfor %}
                </div>
            </div>

             <!-- Password Field -->
             <div class="mb-3">
                <label for="password" class="form-label">Password</label>
                <input type="password" class="form-control {% if form.password.errors %}is-invalid{% endif %}" 
                       id="password" name="password" placeholder="xxxxxxxx" minlength="8">
                <div id="passwordError" class="invalid-feedback">
                    {% for error in form.password.errors %}
                        {{ error }}
                    {% endfor %}
                </div>
            </div>

            <!-- Confirm Password Field -->
            <div class="mb-3">
                <label for="confirm_password" class="form-label">Confirm Password</label>
                <input type="password" class="form-control {% if form.confirm_password.errors %}is-invalid{% endif %}" 
                    id="confirm_password" name="confirm_password" placeholder="xxxxxxxx" minlength="8">
                <div id="confirmPasswordError" class="invalid-feedback">
                    {% for error in form.confirm_password.errors %}
                        {{ error }}
                    {% endfor %}
                </div>
            </div>
            <button type="submit" class="btn btn-primary">Register</button>
        </form>
  
        <p class="mt-3">Already have an account? <a href="{% url 'login' %}">Login here</a></p>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0-alpha1/js/bootstrap.bundle.min.js"></script>
    <script>
        document.getElementById('registrationForm').addEventListener('submit', function(event) {
            event.preventDefault(); // Prevent the form from submitting
            var form = this;
            var isValid = true;

            // Clear previous error messages
            var errorElements = form.querySelectorAll('.invalid-feedback');
            errorElements.forEach(function(element) {
                element.textContent = '';
            });

            // Username validation
            var username = form.username.value.trim();
            if (username === '') {
                isValid = false;
                document.getElementById('usernameError').textContent = 'Username is required.';
                form.username.classList.add('is-invalid');
            } else if (username.length > 20) {
                isValid = false;
                document.getElementById('usernameError').textContent = 'Username cannot exceed 20 characters.';
                form.username.classList.add('is-invalid');
            } else {
                form.username.classList.remove('is-invalid');
            }

            // First name validation
            var firstName = form.first_name.value.trim();
            if (firstName === '') {
                isValid = false;
                document.getElementById('firstNameError').textContent = 'First name is required.';
                form.first_name.classList.add('is-invalid');
            } else if (!/^[A-Za-z]+$/.test(firstName)) {
                isValid = false;
                document.getElementById('firstNameError').textContent = 'First name should only contain letters.';
                form.first_name.classList.add('is-invalid');
            } else {
                form.first_name.classList.remove('is-invalid');
            }

            // Last name validation
            var lastName = form.last_name.value.trim();
            if (lastName === '') {
                isValid = false;
                document.getElementById('lastNameError').textContent = 'Last name is required.';
                form.last_name.classList.add('is-invalid');
            } else if (!/^[A-Za-z]+$/.test(lastName)) {
                isValid = false;
                document.getElementById('lastNameError').textContent = 'Last name should only contain letters.';
                form.last_name.classList.add('is-invalid');
            } else {
                form.last_name.classList.remove('is-invalid');
            }

            // Email validation
            var email = form.email.value.trim();
            var emailPattern = /^[a-zA-Z0-9._%-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
            var domainPattern = /^[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;

            if (email === '') {
                isValid = false;
                document.getElementById('emailError').textContent = 'Email is required.';
                form.email.classList.add('is-invalid');
            } else if (email.length > 256) {
                isValid = false;
                document.getElementById('emailError').textContent = 'Email cannot exceed 256 characters.';
                form.email.classList.add('is-invalid');
            } else if (!emailPattern.test(email)) {
                isValid = false;
                document.getElementById('emailError').textContent = 'Invalid email format.';
                form.email.classList.add('is-invalid');
            } else {
                var domain = email.split('@')[1];
                if (!domainPattern.test(domain)) {
                    isValid = false;
                    document.getElementById('emailError').textContent = 'Invalid domain format.';
                    form.email.classList.add('is-invalid');
                } else if (/^[0-9]+$/.test(domain.split('.').pop())) {
                    isValid = false;
                    document.getElementById('emailError').textContent = 'Top-level domain cannot be numeric.';
                    form.email.classList.add('is-invalid');
                } else {
                    form.email.classList.remove('is-invalid');
                }
            }

            // Password validation
            var password = form.password.value;
            if (password === '') {
                isValid = false;
                document.getElementById('passwordError').textContent = 'Password is required.';
                form.password.classList.add('is-invalid');
            } else if (password.length < 8) {
                isValid = false;
                document.getElementById('passwordError').textContent = 'Password must be at least 8 characters long.';
                form.password.classList.add('is-invalid');
            } else {
                form.password.classList.remove('is-invalid');
            }

            // Confirm password validation
            var confirmPassword = form.confirm_password.value;
            if (confirmPassword === '') {
                isValid = false;
                document.getElementById('confirmPasswordError').textContent = 'Confirm password is required.';
                form.confirm_password.classList.add('is-invalid');
            } else if (confirmPassword !== password) {
                isValid = false;
                document.getElementById('confirmPasswordError').textContent = 'Passwords do not match.';
                form.confirm_password.classList.add('is-invalid');
            } else {
                form.confirm_password.classList.remove('is-invalid');
            }

            if (isValid) {
                form.submit(); // Submit the form if all validations pass
            }
        });
    </script>
</body>
</html>
